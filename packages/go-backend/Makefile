# AI Vault Backend Makefile

.PHONY: help build run test clean docker-build docker-run docker-stop docker-logs install deps

# Default target
help:
	@echo "AI Vault Backend - Available Commands:"
	@echo ""
	@echo "Development:"
	@echo "  install     Install dependencies"
	@echo "  build       Build the application"
	@echo "  run         Run the application locally"
	@echo "  test        Run tests"
	@echo "  clean       Clean build artifacts"
	@echo ""
	@echo "Docker:"
	@echo "  docker-build    Build Docker image"
	@echo "  docker-run      Run with Docker Compose"
	@echo "  docker-stop     Stop Docker containers"
	@echo "  docker-logs     View Docker logs"
	@echo ""
	@echo "Database:"
	@echo "  db-migrate      Run database migrations"
	@echo "  db-reset        Reset database"
	@echo ""
	@echo "Utilities:"
	@echo "  setup-env       Setup environment file"
	@echo "  check-env       Check environment configuration"

# Install dependencies
install:
	@echo "ğŸ“¦ Installing dependencies..."
	go mod download
	go mod tidy

# Build the application
build:
	@echo "ğŸ”¨ Building application..."
	go build -o ai-vault-backend main.go
	@echo "âœ… Build completed"

# Run the application
run:
	@echo "ğŸš€ Starting application..."
	@./scripts/start.sh

# Run tests
test:
	@echo "ğŸ§ª Running tests..."
	go test -v ./...

# Clean build artifacts
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -f ai-vault-backend
	go clean

# Setup environment file
setup-env:
	@echo "âš™ï¸  Setting up environment file..."
	@if [ ! -f .env ]; then \
		cp env.example .env; \
		echo "ğŸ“ Created .env file from template"; \
		echo "âš ï¸  Please update .env with your configuration"; \
	else \
		echo "âœ… .env file already exists"; \
	fi

# Check environment configuration
check-env:
	@echo "ğŸ” Checking environment configuration..."
	@if [ ! -f .env ]; then \
		echo "âŒ .env file not found. Run 'make setup-env' first"; \
		exit 1; \
	fi
	@echo "âœ… .env file exists"

# Docker commands
docker-build:
	@echo "ğŸ³ Building Docker image..."
	docker build -t ai-vault-backend .

docker-run:
	@echo "ğŸ³ Starting with Docker Compose..."
	@./scripts/docker-start.sh

docker-stop:
	@echo "ğŸ›‘ Stopping Docker containers..."
	docker-compose down

docker-logs:
	@echo "ğŸ“‹ Viewing Docker logs..."
	docker-compose logs -f

# Database commands
db-migrate:
	@echo "ğŸ—„ï¸  Running database migrations..."
	@echo "Note: Migrations run automatically on startup"

db-reset:
	@echo "ğŸ—„ï¸  Resetting database..."
	docker-compose down -v
	docker-compose up -d postgres
	@echo "âœ… Database reset completed"

# Development setup
dev-setup: setup-env install
	@echo "ğŸ¯ Development setup completed!"
	@echo "Next steps:"
	@echo "1. Update .env file with your configuration"
	@echo "2. Run 'make run' to start the application"

# Production build
prod-build: clean install build
	@echo "ğŸ­ Production build completed"

# Quick start
quick-start: setup-env docker-run
	@echo "ğŸ‰ Quick start completed!"
